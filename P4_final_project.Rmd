---
title: "P4_final_project: EDA of the White Wine dataset"
author: "CWT"
date: "08/01/2017"
output:
  html_document: default
  html_notebook: default
---
```{r setup enviro, include=FALSE}

# reference the video: https://www.youtube.com/watch?v=0bxa7rkur9o

# r echo=FALSE, message=FALSE, warnings=FALSE, packages

# The parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file. Unless it makes
# sense for your report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should be set to FALSE
# for other code chunks once you have verified that each plot comes out as
# want it to.  This will clean up the flow of your report.

# Set up the environment
# Loading all packages that I end up using
# in my analysis in this code chunk.

library(ggplot2)
library(GGally)
library(scales)
library(memisc)
library(lattice)
library(MASS)
library(car)
library(reshape)
library(dplyr)
library(knitr)
library(caret)
library(gridExtra)

#install.packages('nlme', dependencies = TRUE)
#library(nlme)

#install.packages('psych', dependencies = TRUE)
library(psych)

# install.packages('moments', dependencies = TRUE)
library(moments)

# install.packages('RcolorBrewer', dependencies = TRUE)
library(RColorBrewer)

# install.packages('pastecs', dependencies = TRUE)
library(pastecs)

opts_chunk$set(echo = FALSE)

```

```{r global_options, include=FALSE}

# Use this chuck to remove unnecessary warnings/messages to show in your knitted file. I recommend adding a global option chunk in the beginning of your rmd file as follows:

knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)

# The fig.width and fig.height option can also help when you need to adjust the plot sizes.

```

```{r setup variables}

#read the dataset and remove the column with name 'X'

white_wine <- read.csv("wineQualityWhites.csv")
white_wine$X <- NULL

#convert quality attribute from int to factor

quality.fac <- as.factor(white_wine$quality)

#partition the dataset into discrete quality bins

quality.high <- subset(white_wine, quality == 7 | quality == 8 | quality == 9)
quality.med <- subset(white_wine, quality == 6)
quality.low <- subset(white_wine, quality == 3 | quality == 4 | quality == 5)

```

## Introduction

This report explores a dataset containing quality and attributes for approximately 4900 white wines. The dataset is related to white variants of the Portuguese "Vinho Verde" wine [1]. The inputs include objective tests (e.g. PH values) and the output is based on sensory data (median of at least 3 evaluations made by wine experts). Each expert graded the wine quality between 0 (very bad) and 10 (very excellent).

### The Input Variables

The eleven input variables of this white wine dataset based on physicochemical tests are listed below with their respective units of measurement.
   
1 - Fixed Acidity (tartaric acid - g/dm^3)

2 - Volatile Acidity (acetic acid - g/dm^3)

3 - Citric Acid (g/dm^3)

4 - Residual Sugar (g/dm^3)

5 - Chlorides (sodium chloride - g/dm^3)

6 - Free Sulfur Dioxide (mg/dm^3)

7 - Total Sulfur Dioxide (mg/dm^3)

8 - Density (g/cm^3)

9 - pH (potential of hydrogen)

10 - Sulphates (potassium sulphate - g/dm^3)

11 - Alcohol (% by volume)
   
Note: dm^3 stands for cubic decimeter which is equivalent to 1 Liter
   
### Output Variable

The single output variable in this dataset is quality.  This attribute is subjective based on expert sensory data. Each expert graded the wine quality between 0 (very bad) and 10 (very excellent). The quality variable for each white wine in this study is based on the median of at least 3 evaluations made by wine experts. Throughout this exploratory data analysis the input variables are measured against the quality variable in an attempt to determine what chemical attributes make a high quality white wine.
   
## More about the Analysis of What Makes a High Quality Wine
   
### The Sugar Content

Sugar content is an essential indicator of vinification (the conversion of grape juice or other vegetable extract into wine by fermentation). Measured during maturity inspections, the sugar content allows the date of the harvest to be anticipated. It takes approximately 16.83 g/l of sugar for a yeast to produce 1% volume of alcohol. It also allows the alcoholic fermentation to be monitored (therefore the transformation of the sugar into alcohol), and it can give the quantity of residual sugars in a wine. The residual sugars contribute to the balance of a wine [2].

### Residual Sugar (g/l)

The amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet.

### Alcohol (% by volume)

The Alcohol of each wine in the study is the percent alcohol content of the wine. The alcohol content is also an indicator, the gustatory approach to a wine with 11% alcohol by volume will be different to a wine with 14% volume. But note that the alcohol content alone is not an indicator of the quality of the wine. A wine with 14% volume does not necessarily translate into a higher quality than a wine with 14% volume. Everything is a question of balance with the other parameters (sugars, acidity, etc.) and material.

### Total Acidity

This is the sum of the volatile acidity and the fixed acidity.

Wine contains a certain number of mineral and organic acids. Some of these acids in the wine are entirely combined with alkali - they are in salt form and therefore are not involved in the perception of the acidity of the wine. However, certain organic acids are only partially saturated by alkali or turned into salts. Some of their molecules are in salt form, others are free. The sum of the free acid functions and the partly free acids constitutes the acidity of the wine. The three main acids in wine are tartaric, malic and citric acid. Tartaric acid is the specific acid of the grape and of wine - it is found very little in natural form except in vines. Malic acid is an organic acid which is very common in the plant world, it is the main acid in many fruits. Citric acid exists in grapes of every variety and in greater quantity in most concentrated by gray fungus that is deliberately cultivated on grapes to enhance the making of certain sweet wines.

### Fixed Acidity

Most acids involved with wine are fixed or nonvolatile (do not evaporate readily).

### Volatile Acidity

The volatile acidity of a wine consists of the part of the fatty acids belonging to the acetic series, which is found in wine either in the free state or in salt form. Volatile acidity gives the wine its characteristic taste, but when the dose of volatile acid is too high the wine is said to be "sour", characterized by notes of glue or vinegar. Therefore the amount of acetic acid in wine at too high of levels can lead to an unpleasant vinegar taste.

### The pH

Parallel to the total acidity, the free acid functions are partially dissociated or ionized and release H+ ions into the liquid, which represent the "real" acidity, whose concentration is expressed as a pH. It depends to a large extent on tartaric acid.

pH is a scale of acidity from 0 to 14. It tells how acidic or alkaline a substance is. More acidic solutions, have lower pH. More alkaline solutions, have higher pH. Substances that aren't acidic or alkaline (that is, neutral solutions) usually have a pH of 7.

### Sulfur Dioxide (SO2)

The use of sulfur dioxide is widely accepted as a useful winemaking aide. It is used as a preservative because of its anti-oxidative and anti-microbial properties in wine, but also as a cleaning agent for barrels and winery facilities [3]. To make high quality wines, a winemaker needs to learn how to effectively manage the sulfite levels. When done correctly, maintaining the proper amount of sulfites in a wine protects it from oxidation and microbial contamination during ageing and storage. The amount of SO2 needed to protect a wine is based on the wine's pH. The higher the pH the more SO2 will be needed, and conversely, the lower the pH the less SO2 will be needed to attain the ideal level [4]. SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident to the smell and taste of wine.

### Sodium Chloride

The amount of salt in the wine. Generally moderate to large concentrations of salt give the wine a salty flavor which may turn away potential customers.  Generally a wine with less than .06 g/dm^3 is generally referred to as a low salt level [5].

## My Exploratory Data Analysis of the White Wine Dataset

The first order of this EDA is to look at the summary of the wine attributes. This information provides the basic statistics to be used throughout the analysis, helping with bin sizing and scaling as appropriate.  Along with the mean and median, I always like to have the standard deviations of the variables as well.

As I scan through the various attributes that were given about wines I notice a categorical variable called 'quality'. I focus on this variable because my thought is a higher quality wine would be more broadly appealing and therefore have a higher value and command a higher price.

As mentioned in the introduction, the quality parameter is between 0 and 10 however within this dataset the minimum is 3 and there are no 10's. As the focus of this EDA is on the quality parameter and attempts to fit a multiple linear regression model to help explain what makes a high quality white wine, I partitioned the quality parameter into 3 bins; High, Med, and Low.  High is defined as quality values of 7, 8, and 9, Med defined as a quality value of 6, and Low is defined as quality values of 3, 4, and 5. The focus will be on the High quality.

### The Summary of the Wine Attributes


```{r}

summary(white_wine)

```

### The Standard Deviation of Each Wine Attributes

```{r}

sapply(white_wine, sd)

```

### Correlation Matrix

The following matrix provides the correlation between each pair of attributes. This is a very important first step when doing EDA because it provides a quick way to determine which pair of variables have the strongest relationships,  Each cell in the matrix provides the correlation coefficient (r) which measures the strength and direction of a linear relationship between pair of variables.  The value of r is always between +1 and-1. r = 0 indicate no relationship, r = +/- 1 indicate perfect positive and negative relationship respectively, below +/- .50 indicate weak relationship, between +/-.50 and +/- .70 a moderate relationship, and greater than +/- .70 a strong relationship.

Reviewing correlation between white wine attributes and specifically focusing on the quality attribute column, the strongest relationship is with alcohol although at .44 it is a weak relationship.  Including all other pairs in the matrix the strong relationships are between density vs. residual sugar at .84, and density vs. alcohol with -.78.

```{r}

# Correlation plot

ggcorr(white_wine, label = TRUE, label_round = 2, label_size = 3,
       hjust = 0.75, layout.exp = 2) +
  ggtitle("Correlation between White Wine Attributes")

```

### Matrix of the Scatterplots, and Univariate Analysis

Along with the correlation matrix, I find it very helpful when in the discovery mode to look at a very cursory view of the scatterplots of all pairs with my study.  The following matrix provides this matrix using the ggpairs function. Rather than just the single correlation coefficient this matrix provides a more visual look at the relationships.  Also the diagonal of this matrix provide a compact univariate analysis of all the variables. It illustrates the distribution of each variable.  We will go into more depth of each distribution next but I find having all variables together in one figure very helpful to gain a better understanding of the variables. I will note that with ggpairs the correlations and scatterplots can be combined into one figure however I chose to separate them.

Most of the white wine variables exhibit a normal distribution with the exception of residual sugar which has a positive skew.  Alcohol is also a little bit different than a normal distribution however I would not say it is dramatically skewed.
 

```{r}

ggpairs(white_wine, upper = 'blank',
        lower = list(continuous = wrap('points', shape = I('.')))) +
  ggtitle("Variable Matrix of White Wine Attributes")

```

### The "Quality"" Variable Distribution

The distribution of the quality variable is given in the figure below.  Recall in this dataset the quality values are discrete whole numbers from 3 to 9.  We see within this histogram the quality of 6 squarely in the middle of the distribution is the dominate value at 2198.  And we note there are more wines below this mean than above indicating a slight positive skew [8] - calculating the skew with the moments library results in a skew of 0.156 as depicted in the drawing which is very slight as the visual suggests.

```{r}

# https://stackoverflow.com/questions/24198896/how-to-get-data-labels-for-a-histogram-in-ggplot2

# https://www.r-bloggers.com/measures-of-skewness-and-kurtosis/

skew <- round(skewness(white_wine$quality), digits = 3)

ggplot(white_wine, aes(quality)) +
  stat_bin(binwidth = 1, fill = 'dodgerblue2') +
  ylim(c(0, 2500)) +
  stat_bin(binwidth = 1, geom = "text", aes(label=..count..), vjust=-1.5) +
  ggtitle('Distribution of Quality within the White Wine Dataset') +
  xlab('Quality - based on sensory data (scored 0-10)') +
  ylab('Number of Wines') +
  geom_text(aes(8, 2300, label=paste("skewness:", skew)))

```


```{r}

# define the wine quality levels and order them high, med, low 

white_wine$quality.levels <- ifelse(white_wine$quality < 6, "low", 
                                    ifelse(white_wine$quality == 6,
                                           "med", "high"))
white_wine$quality.levels <- factor(white_wine$quality.levels,
                                    levels=c("high", "med", "low"),
                                    ordered=TRUE)

```

### Distribution of Variables (Univariate and Bivariate Plots)

Now let's dive into each variable with more detail. As I explore this data further I wanted to add the component of quality into each variable. So within each of the bins in the distribution I use quality levels (High, Med, and Low) to visualize how the quality levels are distributed.

Quality Levels:

High = 7, 8, and 9

Med = 6

Low = 3, 4, and 5

Furthermore, I calculated the mean of the distribution for all wines and mean of the distribution for the high quality wines only. For each graph I have the means depicted with a vertical dotted lines, the black line is the mean of the variable for all wines and red is the mean of the variable for taking into account only the high quality wines.  With the means I wanted to see how much difference there were between the two means to determine how much of an impact a particular variable has on the high quality wines. The thought is if there is a significant difference between the two means then it would give me more information about how much of an effect a variable would have on high quality. Each graph provides a 'std mean diff' number than is the standardized difference between the two means. The standardized number is calculated by dividing the absolute value of the difference between the two means with the standard deviation associated with that variable.   

#### Alcohol

The mean of the high quality wines are greater than the overall mean and the std diff mean is .733 which means it's less than one standard deviation.  This indicates that while there is some difference between these two populations they are not significant. This agrees with the correlation study where the correlation between alcohol and quality was .44, a weak relationship. I expect the rest of the variables will have an even weaker relationship but let's go through each of them to see how much influence they have on the high quality wines.

```{r}

#http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/

standardized_diff <- round(abs(mean(quality.high$alcohol) - mean(white_wine$alcohol)) / (sd(white_wine$alcohol)), digits = 3)

ggplot(white_wine, aes(alcohol, fill=quality.levels)) +
  geom_histogram(binwidth = 0.1, colour="black") +
  scale_x_continuous(lim = c(8, quantile(white_wine$alcohol, 0.99))) +
  ggtitle('Alcohol Distribution with Quality Levels') +
  xlab('Alcohol (% by Volume)') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$alcohol)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$alcohol)),color="black", linetype="dashed", size=1)+
  geom_text(aes(12.5, 250, label=paste("std mean diff:", standardized_diff)))

```




#### Density

```{r}

standardized_diff <- round(abs(mean(quality.high$density) - mean(white_wine$density)) / (sd(white_wine$density)), digits = 3)

ggplot(white_wine, aes(density, fill=quality.levels)) +
  geom_histogram(binwidth = 0.0005, colour="black") +
  scale_x_continuous(lim = c(0.985, quantile(white_wine$density, 0.999))) +
  ggtitle('Density Distribution with Quality Levels') +
  xlab('Density (g/mL)') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$density)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$density)),color="black", linetype="dashed", size=1) +
  geom_text(aes(.999, 320, label=paste("std mean diff:", standardized_diff)))

```

#### Sulphates

```{r}

standardized_diff <- round(abs(mean(quality.high$sulphates) - mean(white_wine$sulphates)) / (sd(white_wine$sulphates)), digits = 3)

ggplot(white_wine, aes(sulphates, fill=quality.levels)) +
  geom_histogram(binwidth = 0.01, colour="black") +
  scale_x_continuous(lim = c(0.2, quantile(white_wine$sulphates, 0.99))) +
  ggtitle('Sulphates Distribution with Quality Levels') +
  xlab('Sulphates (g/L)') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$sulphates)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$sulphates)),color="black", linetype="dashed", size=1) +
  geom_text(aes(.7, 240, label=paste("std mean diff:", standardized_diff)))

```

#### Chlorides

```{r}

standardized_diff <- round(abs(mean(quality.high$chlorides) - mean(white_wine$chlorides)) / (sd(white_wine$chlorides)), digits = 3)

ggplot(white_wine, aes(chlorides, fill=quality.levels)) +
  geom_histogram(binwidth = 0.001, colour="black") +
  scale_x_continuous(lim = c(0.009, quantile(white_wine$chlorides, 0.97))) +
  ggtitle('Chlorides Distribution with Quality Levels') +
  xlab('Chlorides (g/L)') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$chlorides)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$chlorides)),color="black", linetype="dashed", size=1) +
  geom_text(aes(.07, 190, label=paste("std mean diff:", standardized_diff)))

```

#### pH

```{r}

standardized_diff <- round(abs(mean(quality.high$pH) - mean(white_wine$pH)) / (sd(white_wine$pH)), digits = 3)

ggplot(white_wine, aes(pH, fill=quality.levels)) +
  geom_histogram(binwidth = 0.01, colour="black") +
  scale_x_continuous(lim = c(2.7, quantile(white_wine$pH, 0.99))) +
  ggtitle('pH Distribution with Quality Levels') +
  xlab('pH') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$pH)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$pH)),color="black", linetype="dashed", size=1) +
  geom_text(aes(3.45, 170, label=paste("std mean diff:", standardized_diff)))

```

#### Fixed Acidity

```{r}

standardized_diff <- round(abs(mean(quality.high$fixed.acidity) - mean(white_wine$fixed.acidity)) / (sd(white_wine$fixed.acidity)), digits = 3)

ggplot(white_wine, aes(fixed.acidity, fill=quality.levels)) +
  geom_histogram(binwidth = 0.1, colour="black") +
  scale_x_continuous(lim = c(4.0, quantile(white_wine$fixed.acidity, 0.99))) +
  ggtitle('Fixed Acidity Distribution with Quality Levels') +
  xlab('Fixed Acidity') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$fixed.acidity)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$fixed.acidity)),color="black", linetype="dashed", size=1) +
  geom_text(aes(8.5, 300, label=paste("std mean diff:", standardized_diff)))

```

#### Volatile Acidity

```{r}

standardized_diff <- round(abs(mean(quality.high$volatile.acidity) - mean(white_wine$volatile.acidity)) / (sd(white_wine$volatile.acidity)), digits = 3)

ggplot(white_wine, aes(volatile.acidity, fill=quality.levels)) +
  geom_histogram(binwidth = 0.01, colour="black") +
  scale_x_continuous(lim = c(0.05, quantile(white_wine$volatile.acidity, 0.99))) +
  ggtitle('Volatile Acidity Distribution with Quality Levels') +
  xlab('Volatile Acidity') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$volatile.acidity)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$volatile.acidity)),color="black", linetype="dashed", size=1) +
  geom_text(aes(.5, 250, label=paste("std mean diff:", standardized_diff)))

```

#### Citric Acidity

```{r}

standardized_diff <- round(abs(mean(quality.high$citric.acid) - mean(white_wine$citric.acid)) / (sd(white_wine$citric.acid)), digits = 3)

ggplot(white_wine, aes(citric.acid, fill=quality.levels)) +
  geom_histogram(binwidth = 0.01, colour="black") +
  scale_x_continuous(lim = c(0, quantile(white_wine$citric.acid, 0.99))) +
  ggtitle('Citric Acid Distribution with Quality Levels') +
  xlab('Citric Acid') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$citric.acid)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$citric.acid)),color="black", linetype="dashed", size=1) +
  geom_text(aes(.6, 300, label=paste("std mean diff:", standardized_diff)))

```

#### Free Sulfur Dioxide

```{r}

standardized_diff <- round(abs(mean(quality.high$free.sulfur.dioxide) - mean(white_wine$free.sulfur.dioxide)) / (sd(white_wine$free.sulfur.dioxide)), digits = 3)

ggplot(white_wine, aes(free.sulfur.dioxide, fill=quality.levels)) +
  geom_histogram(binwidth = 2, colour="black") +
  scale_x_continuous(lim = c(0, quantile(white_wine$free.sulfur.dioxide, 0.99))) +
  ggtitle('Free Sulfur Dioxide Distribution with Quality Levels') +
  xlab('Free Sulfur Dioxide') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$free.sulfur.dioxide)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$free.sulfur.dioxide)),color="black", linetype="dashed", size=1) +
  geom_text(aes(65, 250, label=paste("std mean diff:", standardized_diff)))

```

#### Total Sulfur Dioxide

```{r}

standardized_diff <- round(abs(mean(quality.high$total.sulfur.dioxide) - mean(white_wine$total.sulfur.dioxide)) / (sd(white_wine$total.sulfur.dioxide)), digits = 3)

ggplot(white_wine, aes(total.sulfur.dioxide, fill=quality.levels)) +
  geom_histogram(binwidth = 5, colour="black") +
  scale_x_continuous(lim = c(0, quantile(white_wine$total.sulfur.dioxide, 0.99))) +
  ggtitle('Total Sulfur Dioxide Distribution with Quality Levels') +
  xlab('Total Sulfur Dioxide') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$total.sulfur.dioxide)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$total.sulfur.dioxide)),color="black", linetype="dashed", size=1) +
  geom_text(aes(200, 250, label=paste("std mean diff:", standardized_diff)))

```

#### Residual Sugar

Residual Sugar is a unique attribute in this dataset because it's a dramatically skewed distribution.  We deal with this kind distribution by transforming the scale to log 10. The succeeding plot is the log 10 distribution and Residual Sugar, which turns it into a bimodal distribution.

```{r}

standardized_diff <- round(abs(mean(quality.high$residual.sugar) - mean(white_wine$residual.sugar)) / (sd(white_wine$residual.sugar)), digits = 3)

skew <- round(skewness(white_wine$residual.sugar), digits = 3)

ggplot(white_wine, aes(residual.sugar, fill=quality.levels)) +
  geom_histogram(binwidth = 0.5, colour="black") +
  scale_x_continuous(lim = c(0.6, quantile(white_wine$residual.sugar, 0.999))) +
  ggtitle('Residual Sugar Distribution with Quality Levels') +
  xlab('Residual Sugar (g/L)') + 
  ylab('Number of Wines') +
  geom_vline(aes(xintercept=mean(quality.high$residual.sugar)),color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=mean(white_wine$residual.sugar)),color="black", linetype="dashed", size=1) +
  geom_text(aes(18, 700, label=paste("std mean diff:", standardized_diff))) +
  geom_text(aes(18, 650, label=paste("skewness:", skew)))

```

#### Residual Sugar (log 10)

```{r}

ggplot(white_wine, aes(residual.sugar, fill=quality.levels)) +
  geom_histogram(binwidth = 0.03, colour="black") +
  scale_x_log10(breaks = c(1, 2, 4, 8, 16, 32)) +
  ggtitle('Log 10 Residual Sugar Distribution with Quality Levels') +
  xlab('Residual Sugar - log10 (g/L)') + 
  ylab('Number of Wines')

```

### Standardized Mean Difference (a.k.a. Cohen's d)

The following list provides the standardized mean difference for each variable.  This is also referred to as Cohen's d. However a typical Cohen's d relationship is performed between means of different populations.  Here I use the relationship between the mean of the entire population versus the mean of high quality population (which is a subset of the entire population).  Therefore we'll have to take this into account when interpreting the effect size of the results.  Even though this Cohen's d analysis does not use independent populations I feel like the results are helpful in determining the relative relationship between the white wine variable and high quality.[9]   

1 - Fixed Acidity = 0.154

2 - Volatile Acidity = 0.128

3 - Citric Acid = 0.067

4 - Residual Sugar = 0.233

5 - Chlorides = 0.348

6 - Free Sulfur Dioxide = 0.045

7 - Total Sulfur Dioxide = 0.309

8 - Density = 0.540

9 - pH = 0.178

10 - Sulphates = 0.090

11 - Alcohol = 0.733

#### A Note about Effect Size.

Cohen originally gave guidelines as to what constitutes a small, medium, and large effect. He gave the guidelines of 0.2 as small, 0.5 as medium, and 0.8 and higher as large. However, these guidelines are only potentially useful if you are doing research in an area that has no history of effect sizes, or that you are unable to evaluate for yourself whether the obtained effect is practically meaningful.

So when interpreting effect sizes we will want to contextualize the effects in relation to similar research in other areas to give a sense of where the result stands relative to the field of study. Otherwise the reviewer will not know how to evaluate the findings. There are usually no absolutely "big" or absolutely "small" effects - there are only meaningful effects relative to the research area under investigation.[10]

#### Effect Size of the White Wine Attributes

The determination of the degree of effect size in this study is to compare each white wine attribute against the others.  For example alcohol and density have a highest effect size of the attributes, while citric acid and free sulfur dioxide have the smallest.  Therefore we would expect alcohol and density to be greater predictors of quality level then citric acid and free sulfur dioxide.

### Bivariate Plots

Now we turn our attention to the Bivariate Plots by focusing on the variables that have the highest correlation - alcohol, density, and residual.sugar. High quality wine is strongly correlated with the higher alcohol wines with low density and low sugar. Based on R-squared these three variables explain about 21% of the variance in quality.

```{r}

pairs.panels(white_wine[c("alcohol", "density", "residual.sugar")], lm = TRUE, show.points = TRUE, rug = FALSE)

```

```{r}

plot1 <- ggplot(white_wine, aes(density, alcohol)) +
  geom_boxplot() +
  facet_grid(~ quality.levels)
  
plot2 <- ggplot(white_wine, aes(density, residual.sugar)) +
  geom_boxplot() +
  facet_wrap(~ quality.levels)

plot3 <- ggplot(white_wine, aes(residual.sugar, alcohol)) +
  geom_boxplot() +
  facet_wrap(~ quality.levels)

plot4 <- ggplot(white_wine, aes(residual.sugar, density)) +
  geom_boxplot() +
  facet_wrap(~ quality.levels)

plot5 <- ggplot(white_wine, aes(alcohol, density)) +
  geom_boxplot() +
  facet_wrap(~ quality.levels)

plot6 <- ggplot(white_wine, aes(alcohol, residual.sugar)) +
  geom_boxplot() +
  facet_wrap(~ quality.levels)

grid.arrange(plot1, plot2, plot3, plot4, plot5, plot6, ncol=2)

```

### Multivariate Plots

Let's go back to the correlation matrix and explore the two relationships that exhibited the highest correlation: Alcohol vs. Density (-0.78), and Residual Sugar vs. Density (0.84).  But this time we'll add quality as the 3rd variable.

#### White Wine Quality with Alcohol vs. Density (-0.78)

The following graph is a scatterplot of Alcohol vs. Density.  I notice a negative linear trend which is expected given the negative correlation. With respect to quality I notice a clustering of high quality wine samples toward the higher alcohol volumes.  I also find it interesting that there is a smaller clustering of high quality wine samples near and at the bottom of the alcohol volume spectrum.  The low quality wine samples appear to be clustered from the middle to lower alcohol volumes - not so many toward the high volume portion.

```{r}

ggplot(white_wine, aes(alcohol, density, colour = quality.levels)) +
  geom_jitter(alpha = 1, width = 0.1, height = 0.001) +
  scale_x_continuous(lim = c(8, quantile(white_wine$alcohol, 0.99))) +
  scale_y_continuous(lim = c(0.985, quantile(white_wine$density, 0.99))) +
  scale_color_brewer(type = 'div', palette = 'Spectral',
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 6))) + 
  ggtitle("White Wine Quality with Alcohol vs. Density") +
  xlab('Alcohol (% by volume)') +
  ylab('Density (g/mL)')

```

The next two figures plot the high and low quality distributions of the Alcohol variable respectfully.  The high quality histogram shows a multimodal distribution which could be bimodal or even tri-modal if there is such a concept.  We can see within this profile the clustering at the lower volume levels as noted before.  Whereas the low quality distribution is much more normal with a small positive skew.

```{r}
ggplot(aes(x = alcohol), data = quality.high, colour = quality.levels) +
  geom_histogram(binwidth = 0.1, colour="black", fill="darkorange1", alpha = .7) +
  scale_x_continuous(lim = c(8, quantile(white_wine$alcohol, 0.99))) +
  ggtitle('High Quality White Wine Distribution by Alcohol') +
  xlab('Alcohol (% by volume)') + 
  ylab('Number of Wines')
```

```{r}
ggplot(aes(x = alcohol), data = quality.low, colour = quality.levels) +
  geom_histogram(binwidth = 0.1, colour="black", fill="darkgreen", alpha = .7) +
  scale_x_continuous(lim = c(8, quantile(white_wine$alcohol, 0.99))) +
  ggtitle('Low Quality White Wine Distribution by Alcohol') +
  xlab('Alcohol (% by volume)') + 
  ylab('Number of Wines')
```

#### White Wine Quality with Residual Sugar vs. Density (0.84)

The following graph is a scatterplot of Alcohol vs. Density.  I notice a positive linear trend which is expected given the positive correlation. In this plot the distribution of low and high quality across Residual Sugar is fairly even, but I notice a split of quality where generally high quality is on the upper half of the scatterplot and low quality on the lower half.  I further add best fit linear model lines on the graph per quality. I notice at lower residual sugar levels the density is more of a predictor of high quality wine than it is at the higher residual sugar levels.  

```{r}

ggplot(NULL, aes(residual.sugar, density, colour = quality.levels)) +
  geom_jitter(data = white_wine, alpha = 1, width = 0.5, height = 0.001) +
  scale_x_continuous(lim = c(0, quantile(white_wine$residual.sugar, 0.99))) +
  scale_y_continuous(lim = c(0.985, quantile(white_wine$density, 0.99))) +
  scale_color_brewer(type = 'div', palette = 'Spectral',
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 6))) + 
  ggtitle("White Wine Quality with Residual Sugar vs. Density") +
  xlab('Residual Sugar (g/L)') +
  ylab('Density (g/mL)') +
  geom_smooth(data = white_wine, method = "lm")

```

## A Linear Model to Predict Quality

Here I will develop a multiple regression model utilizing a simple linear model.  

Quality = B0 + B1(var1) + B2(var2) + ... BN(varN) + k

Where quality is the dependent variable and vars are the various attributes of the white wine within this study (independent variables).  B0 is the constant or intercept term.  B1, B2, etc. are the coefficients or slope parameters. k is the error parameter.[6]

This exercise is an attempt to predict quality based on all of the attributes provided within the given white wine dataset.

This regression analysis will use a stepwise selection of variables by backwards elimination where all candidate variables are considered at first then are eliminated one at a time. After each iteration the model is assessed based on the properties to indicate the quality of the model. The model will try to estimate the coefficients of the variables in the linear equation such that the overall errors of the quality estimation could be minimized.

Below is the results from the first iteration of running the model with all the variables.

As we look at the summary of the linear model fit. We find a collection of estimates of the coefficients of the formula. Each of these values is estimated with some degree of confidence. We have a probability statement of how well we can trust the coefficients. The estimates with 3 stars indicate the probability of rejecting value is low, therefore we keep this value in the model. However there are other probability values that are higher (2 stars or no stars) which indicate a probability these values are wrong and therefore we will want to remove these variables from the model.

We also have an r-squared measure which tells us how well the model explains the variation in the data which is not random.  So this model explains around 28% of errors or residuals from the linear model - which tells me this is a very poor model of wine quality.
 
```{r}

fit <- lm(quality ~ fixed.acidity+volatile.acidity+citric.acid+residual.sugar+chlorides+free.sulfur.dioxide+total.sulfur.dioxide+density+pH+sulphates+alcohol, data = white_wine)

summary(fit)

```

So now we're going to eliminate the variable we trust least, or the variable with the highest probability that it is wrong.  So we will eliminate citric acid and run the model again.  And we notice there is no change to r-squared.

```{r}

fit <- lm(quality ~ fixed.acidity+volatile.acidity+residual.sugar+chlorides+free.sulfur.dioxide+total.sulfur.dioxide+density+pH+sulphates+alcohol, data = white_wine)

summary(fit)

```

Next we'll eliminate all variables that do not have 3 stars.  Run the model again and notice still the r-squared does not improve beyond the 28%.

```{r}

fit <- lm(quality ~ volatile.acidity+residual.sugar+free.sulfur.dioxide+density+pH+sulphates+alcohol, data = white_wine)

summary(fit)

```

Next I elimated all but the three variables used in the Bivariate portion of the analysis - alcohol, density, and sugar.  We find these three variable explain about 21% of the variance in quality.  While 21% is not a high percentage it is most of the 28% including all other variables.

```{r}

fit <- lm(quality ~ residual.sugar+density+alcohol, data = white_wine)

summary(fit)

```

### Final Plots and Summary

#### Plot One

```{r}

# https://stackoverflow.com/questions/24198896/how-to-get-data-labels-for-a-histogram-in-ggplot2

# https://www.r-bloggers.com/measures-of-skewness-and-kurtosis/

skew <- round(skewness(white_wine$quality), digits = 3)

ggplot(white_wine, aes(quality)) +
  stat_bin(binwidth = 1, fill = 'dodgerblue2') +
  ylim(c(0, 2500)) +
  stat_bin(binwidth = 1, geom = "text", aes(label=..count..), vjust=-1.5) +
  ggtitle('Distribution of Quality within the White Wine Dataset') +
  xlab('Quality - based on sensory data (scored 0-10)') +
  ylab('Number of Wines') +
  geom_text(aes(8, 2300, label=paste("skewness:", skew)))

```

####Discription One

Quality is based on sensory data with scores between 0 and 10 is noramlly distributed with a quality score of 6 in the middle.  There is a little skew toward more wines below 6 than above.  This EDA analysis focuses on the attributes that explain the variability of Quality.  

#### Plot Two

```{r}

ggplot(white_wine, aes(alcohol, density, colour = quality.levels)) +
  geom_jitter(alpha = 1, width = 0.1, height = 0.001) +
  scale_x_continuous(lim = c(8, quantile(white_wine$alcohol, 0.99))) +
  scale_y_continuous(lim = c(0.985, quantile(white_wine$density, 0.99))) +
  scale_color_brewer(type = 'div', palette = 'Spectral',
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 6))) + 
  ggtitle("White Wine Quality with Alcohol vs. Density") +
  xlab('Alcohol (% by volume)') +
  ylab('Density (g/mL)')

```

####Discription Two

Alcohol is the most defining variable for high quality wines, as we can clustering of the high quality wines at the high end of alcohol content.  I also note that there is a small cluster of high quality wines at the low end of alcohol as well.

#### Plot Three

```{r}

ggplot(NULL, aes(residual.sugar, density, colour = quality.levels)) +
  geom_jitter(data = white_wine, alpha = 1, width = 0.5, height = 0.001) +
  scale_x_continuous(lim = c(0, quantile(white_wine$residual.sugar, 0.99))) +
  scale_y_continuous(lim = c(0.985, quantile(white_wine$density, 0.99))) +
  scale_color_brewer(type = 'div', palette = 'Spectral',
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 6))) + 
  ggtitle("White Wine Quality with Residual Sugar vs. Density") +
  xlab('Residual Sugar (g/L)') +
  ylab('Density (g/mL)') +
  geom_smooth(data = white_wine, method = "lm")

```

####Discription Three

High quality wine is also very highly correlated to density and sugar as well.  Wines are considered high quality are those with the lowest density and sugar content.

## Refection

The quality factor was the median of at least 3 expert evaluations.  To me 'quality' was the key attribute in this dataset because I believe it directly relates to price or value of the wine.  As I explored the data there were several times I wanted to know more about the breakdown of the expert evaluations.  For example I'd like to know more about the evaluators of the high quality wines that were clustered at the low end of the Alcohol continuum - wondering if they are the same clustered group that chose high quality wine at the high end of the Residual Sugar continuum. 

I do realize that I transformed the residual sugar scales to log 10 but never used that transformed scale in the linear model.  With the linear model r-squared at 28% I didn't really find the motivation to add more complexity into the model - ever though the added complexity would have been slight.

The Cohen's d analysis I just kind of stumbled on.  It made intuitive sense to me that comparing the means of the low versus high quality attributes would provide some insight.  Also in order to compare the attributes together on a level basis I knew I had to normalize the differences.  So I just kind of backed into the Cohen's d analysis. Kind of interesting and I something maybe to follow up with for any additional analysis.

I was disappointed about the linear model only yielding a 28% r-squared factor, perhaps an additional set of attributes would be needed to get value that will better explain quality.

## References:

[1] For more details, consult: http://www.vinhoverde.pt/en/ or the reference [Cortez et al., 2009].  Due to privacy and logistic issues, only physicochemical (inputs) and sensory (the output) variables are available (e.g. there is no data about grape types, wine brand, wine selling price, etc.).

[2] Wine Analysing by the Cleebourg Vineyards -  http://www.cave-cleebourg.com/en/wine-analysing/

[3] https://winobrothers.com/2011/10/11/sulfur-dioxide-so2-in-wine/

[4] http://morewinemaking.com/public/pdf/so2.pdf

[5] http://www.oiv.int/public/medias/2604/oiv-ma-d1-03.pdf

[6] http://statlab.stat.yale.edu/workshops/IntroRegression/StatLab-IntroRegressionFa08.pdf

[7] http://www.bing.com/videos/search?q=r+multiple+regression+example&&view=detail&mid=ADC47975E0D7F6C52970ADC47975E0D7F6C52970&FORM=VRDGAR

[8] http://www.mathsisfun.com/data/skewness.html

[9] http://rpsychologist.com/d3/cohend/

[10] http://www.bwgriffin.com/gsu/courses/edur9131/content/cohen_d_Denis.pdf




